# ç³»ç»Ÿæ¶æ„ä¸è°ƒç”¨æµç¨‹

## æ•´ä½“è°ƒç”¨æµç¨‹å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ç”¨æˆ·è¾“å…¥                                  â”‚
â”‚              "ä»€ä¹ˆäººå¯ä»¥è´­ä¹°ç»„å±‹"                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              ChatInterface ç»„ä»¶ (å‰ç«¯)                           â”‚
â”‚  - ä½¿ç”¨ useChat hook (ai/react)                                â”‚
â”‚  - mode: "client" (é»˜è®¤) æˆ– "agent"                             â”‚
â”‚  - POST /api/chat                                               â”‚
â”‚  - body: { messages, mode }                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              /api/chat è·¯ç”± (Next.js API Route)                 â”‚
â”‚                                                                 â”‚
â”‚  1. éªŒè¯ ANTHROPIC_API_KEY                                      â”‚
â”‚     â”œâ”€ æ£€æŸ¥æ˜¯å¦å­˜åœ¨                                             â”‚
â”‚     â””â”€ éªŒè¯æ ¼å¼ (å¿…é¡»ä»¥ "sk-ant-" å¼€å¤´)                          â”‚
â”‚                                                                 â”‚
â”‚  2. è§£æè¯·æ±‚ä½“                                                   â”‚
â”‚     â”œâ”€ messages: å¯¹è¯å†å²                                       â”‚
â”‚     â””â”€ mode: "client" | "agent" (é»˜è®¤: "client")                â”‚
â”‚                                                                 â”‚
â”‚  3. è·å–ç”¨æˆ·ä¿¡æ¯ (å¯é€‰)                                          â”‚
â”‚     â”œâ”€ ä» Supabase è·å–å½“å‰ç”¨æˆ·                                 â”‚
â”‚     â””â”€ è·å– team_id (ç”¨äºçŸ¥è¯†åº“è¿‡æ»¤)                            â”‚
â”‚                                                                 â”‚
â”‚  4. è°ƒç”¨ RAG Pipeline                                          â”‚
â”‚     â””â”€ retrieveRAGContext(userQuery, { teamId, enableScraping })â”‚
â”‚                                                                 â”‚
â”‚  5. æ„å»º System Prompt                                         â”‚
â”‚     â”œâ”€ mode === "agent" â†’ æˆ¿äº§ä¸­ä»‹åŠ©æ‰‹æç¤ºè¯                    â”‚
â”‚     â””â”€ mode === "client" â†’ è´­æˆ¿è€…åŠ©æ‰‹æç¤ºè¯                     â”‚
â”‚                                                                 â”‚
â”‚  6. è°ƒç”¨ Anthropic API                                         â”‚
â”‚     â”œâ”€ æ¨¡å‹: Claude 3.5 Sonnet                                  â”‚
â”‚     â”œâ”€ è¾“å…¥: system prompt + RAG context + messages             â”‚
â”‚     â””â”€ è¿”å›: æµå¼å“åº”                                            â”‚
â”‚                                                                 â”‚
â”‚  7. è¿”å›å“åº”                                                    â”‚
â”‚     â”œâ”€ æµå¼æ–‡æœ¬                                                 â”‚
â”‚     â””â”€ X-Sources å¤´éƒ¨ (å¼•ç”¨æ¥æº)                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              RAG Pipeline (retrieveRAGContext)                  â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ æ­¥éª¤ 1: å‘é‡æ•°æ®åº“æœç´¢ (æ€»æ˜¯æ‰§è¡Œ)                          â”‚  â”‚
â”‚  â”‚                                                           â”‚  â”‚
â”‚  â”‚  searchKnowledgeBase(query, { teamId })                   â”‚  â”‚
â”‚  â”‚    â”œâ”€ generateEmbedding(query)                           â”‚  â”‚
â”‚  â”‚    â”‚   â””â”€ OpenAI API: text-embedding-ada-002              â”‚  â”‚
â”‚  â”‚    â”‚                                                      â”‚  â”‚
â”‚  â”‚    â”œâ”€ createServerClient()                               â”‚  â”‚
â”‚  â”‚    â”‚   â””â”€ Supabase Client                                â”‚  â”‚
â”‚  â”‚    â”‚                                                      â”‚  â”‚
â”‚  â”‚    â””â”€ supabase.rpc('match_kb_chunks', {                  â”‚  â”‚
â”‚  â”‚          query_embedding,                                â”‚  â”‚
â”‚  â”‚          match_threshold: 0.75,                           â”‚  â”‚
â”‚  â”‚          match_count: 4,                                  â”‚  â”‚
â”‚  â”‚          filter_team_id                                   â”‚  â”‚
â”‚  â”‚        })                                                 â”‚  â”‚
â”‚  â”‚                                                           â”‚  â”‚
â”‚  â”‚  è¿”å›: å‰ 4 æ¡æœ€ç›¸ä¼¼çš„çŸ¥è¯†åº“å†…å®¹                           â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ æ­¥éª¤ 2: æ”¿ç­–æ£€æµ‹ä¸ç½‘é¡µæŠ“å– (æ¡ä»¶æ‰§è¡Œ)                      â”‚  â”‚
â”‚  â”‚                                                           â”‚  â”‚
â”‚  â”‚  æ¡ä»¶æ£€æŸ¥:                                                â”‚  â”‚
â”‚  â”‚  â”œâ”€ enableScraping === true                              â”‚  â”‚
â”‚  â”‚  â”œâ”€ JINA_API_KEY å·²è®¾ç½®                                   â”‚  â”‚
â”‚  â”‚  â””â”€ isPolicyQuery(query) === true                        â”‚  â”‚
â”‚  â”‚     â””â”€ æ£€æµ‹å…³é”®è¯: policy, hdb, ura, government ç­‰       â”‚  â”‚
â”‚  â”‚                                                           â”‚  â”‚
â”‚  â”‚  å¦‚æœæ»¡è¶³æ¡ä»¶:                                             â”‚  â”‚
â”‚  â”‚  â”œâ”€ extractUrls(query)                                   â”‚  â”‚
â”‚  â”‚  â”œâ”€ æŸ¥æ‰¾æ”¿åºœç½‘ç«™ URL (hdb.gov.sg, ura.gov.sg ç­‰)          â”‚  â”‚
â”‚  â”‚  â””â”€ scrapeWithJina(url)                                   â”‚  â”‚
â”‚  â”‚     â””â”€ Jina Reader API â†’ Markdown å†…å®¹                    â”‚  â”‚
â”‚  â”‚                                                           â”‚  â”‚
â”‚  â”‚  å¦‚æœæ¡ä»¶ä¸æ»¡è¶³:                                           â”‚  â”‚
â”‚  â”‚  â””â”€ è·³è¿‡æŠ“å–ï¼Œä»…ä½¿ç”¨çŸ¥è¯†åº“                                 â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ æ­¥éª¤ 3: æ„å»ºä¸Šä¸‹æ–‡                                         â”‚  â”‚
â”‚  â”‚                                                           â”‚  â”‚
â”‚  â”‚  formatRAGContext(context, query)                         â”‚  â”‚
â”‚  â”‚    â”œâ”€ æ ¼å¼åŒ–çŸ¥è¯†åº“ç»“æœ (å¸¦å¼•ç”¨ç¼–å· [1], [2]...)            â”‚  â”‚
â”‚  â”‚    â”œâ”€ æ·»åŠ æŠ“å–å†…å®¹ (å¦‚æœæœ‰)                                 â”‚  â”‚
â”‚  â”‚    â””â”€ æ·»åŠ ä½¿ç”¨è¯´æ˜                                         â”‚  â”‚
â”‚  â”‚                                                           â”‚  â”‚
â”‚  â”‚  è¿”å›: æ ¼å¼åŒ–çš„ä¸Šä¸‹æ–‡å­—ç¬¦ä¸²                                 â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                 â”‚
â”‚  è¿”å›: RAGContext {                                            â”‚
â”‚    knowledgeBaseResults: SearchResult[],                       â”‚
â”‚    scrapedContent?: { url, content },                          â”‚
â”‚    sources: Array<{ id, type, content, url }>                 â”‚
â”‚  }                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## è¯¦ç»†è°ƒç”¨æ—¶åº

### åœºæ™¯ 1: æ™®é€šæŸ¥è¯¢ï¼ˆ"ä»€ä¹ˆäººå¯ä»¥è´­ä¹°ç»„å±‹"ï¼‰

```
ç”¨æˆ·è¾“å…¥
  â”‚
  â”œâ”€> ChatInterface
  â”‚     â”‚
  â”‚     â””â”€> POST /api/chat
  â”‚           body: { messages: [...], mode: "client" }
  â”‚
  â”œâ”€> /api/chat è·¯ç”±
  â”‚     â”‚
  â”‚     â”œâ”€> éªŒè¯ API Key âœ“
  â”‚     â”‚
  â”‚     â”œâ”€> è·å–ç”¨æˆ·ä¿¡æ¯ (å¯é€‰)
  â”‚     â”‚     â””â”€> Supabase: get user profile
  â”‚     â”‚
  â”‚     â”œâ”€> retrieveRAGContext("ä»€ä¹ˆäººå¯ä»¥è´­ä¹°ç»„å±‹")
  â”‚     â”‚     â”‚
  â”‚     â”‚     â”œâ”€> searchKnowledgeBase()
  â”‚     â”‚     â”‚     â”œâ”€> generateEmbedding() â†’ OpenAI
  â”‚     â”‚     â”‚     â””â”€> Supabase RPC: match_kb_chunks()
  â”‚     â”‚     â”‚           â””â”€> è¿”å› 4 æ¡ç›¸å…³ç»“æœ
  â”‚     â”‚     â”‚
  â”‚     â”‚     â”œâ”€> isPolicyQuery() â†’ true (åŒ…å«å…³é”®è¯)
  â”‚     â”‚     â”‚
  â”‚     â”‚     â”œâ”€> extractUrls() â†’ [] (æ—  URL)
  â”‚     â”‚     â”‚
  â”‚     â”‚     â””â”€> è·³è¿‡æŠ“å– (æ—  URL æä¾›)
  â”‚     â”‚
  â”‚     â”œâ”€> æ„å»º System Prompt (client æ¨¡å¼)
  â”‚     â”‚     â””â”€> "You are a helpful assistant for Singapore property buyers..."
  â”‚     â”‚
  â”‚     â”œâ”€> formatRAGContext()
  â”‚     â”‚     â””â”€> æ ¼å¼åŒ–çŸ¥è¯†åº“ç»“æœ + ä½¿ç”¨è¯´æ˜
  â”‚     â”‚
  â”‚     â””â”€> experimental_streamText()
  â”‚           â”œâ”€> Anthropic API: Claude 3.5 Sonnet
  â”‚           â””â”€> æµå¼è¿”å›å“åº”
  â”‚
  â””â”€> ChatInterface æ¥æ”¶æµå¼å“åº”
        â””â”€> æ˜¾ç¤ºæ¶ˆæ¯ + Sources
```

### åœºæ™¯ 2: åŒ…å«æ”¿åºœç½‘ç«™ URL çš„æŸ¥è¯¢

```
ç”¨æˆ·è¾“å…¥: "HDB è´­ä¹°èµ„æ ¼æ˜¯ä»€ä¹ˆï¼Ÿhttps://www.hdb.gov.sg/..."
  â”‚
  â””â”€> retrieveRAGContext()
        â”‚
        â”œâ”€> searchKnowledgeBase() â†’ çŸ¥è¯†åº“ç»“æœ
        â”‚
        â”œâ”€> isPolicyQuery() â†’ true
        â”‚
        â”œâ”€> extractUrls() â†’ ["https://www.hdb.gov.sg/..."]
        â”‚
        â”œâ”€> isGovernmentWebsite() â†’ true
        â”‚
        â””â”€> scrapeWithJina(url)
              â””â”€> Jina Reader API â†’ æœ€æ–°ç½‘é¡µå†…å®¹
```

## Mode å‚æ•°è¯´æ˜

### "client" æ¨¡å¼ï¼ˆé»˜è®¤ï¼‰

**ç”¨é€”ï¼š** é¢å‘è´­æˆ¿è€…çš„åŠ©æ‰‹

**System Promptï¼š**
```
You are a helpful assistant for Singapore property buyers. 
You help with:
- Understanding property purchase procedures
- Government policies (HDB, URA, IRAS)
- Financial planning and calculations
- Property market information

Always provide clear, easy-to-understand explanations. 
Use citations [1], [2], etc. when referencing sources.
```

**ä½¿ç”¨åœºæ™¯ï¼š**
- æ™®é€šç”¨æˆ·æŸ¥è¯¢
- è´­æˆ¿è€…å’¨è¯¢
- æ”¿ç­–ç†è§£

### "agent" æ¨¡å¼

**ç”¨é€”ï¼š** é¢å‘æˆ¿äº§ä¸­ä»‹çš„ä¸“ä¸šåŠ©æ‰‹

**System Promptï¼š**
```
You are an expert Singapore property agent assistant. 
You help property agents with:
- Property transaction procedures and regulations
- HDB and private property policies
- Financial calculations (ABSD, TDSR, MSR, LTV)
- Client communication and documentation

Always provide accurate, up-to-date information. 
Use citations [1], [2], etc. when referencing sources.
```

**ä½¿ç”¨åœºæ™¯ï¼š**
- æˆ¿äº§ä¸­ä»‹ä¸“ä¸šæŸ¥è¯¢
- äº¤æ˜“æµç¨‹å’¨è¯¢
- æ³•è§„åˆè§„æ£€æŸ¥

## å…³äº Agent æ¨¡å¼çš„è¯´æ˜

### âŒ å½“å‰å®ç°ä¸æ˜¯çœŸæ­£çš„ Agent

**åŸå› ï¼š**
1. **æ²¡æœ‰å·¥å…·è°ƒç”¨ï¼ˆTool Callingï¼‰**
   - æ— æ³•ä¸»åŠ¨è°ƒç”¨å¤–éƒ¨ API
   - æ— æ³•æ‰§è¡Œå¤šæ­¥éª¤æ“ä½œ
   - æ— æ³•ä½¿ç”¨è®¡ç®—å™¨ã€æ•°æ®åº“æŸ¥è¯¢ç­‰å·¥å…·

2. **æ²¡æœ‰è‡ªä¸»å†³ç­–èƒ½åŠ›**
   - åªæ˜¯æ ¹æ® mode å‚æ•°é€‰æ‹©ä¸åŒçš„ prompt
   - æ‰€æœ‰é€»è¾‘éƒ½æ˜¯é¢„å®šä¹‰çš„
   - æ— æ³•æ ¹æ®ä¸Šä¸‹æ–‡åŠ¨æ€é€‰æ‹©è¡ŒåŠ¨

3. **å•æ¬¡è°ƒç”¨æ¨¡å¼**
   - æ¯æ¬¡è¯·æ±‚éƒ½æ˜¯ç‹¬ç«‹çš„
   - æ²¡æœ‰çŠ¶æ€ç®¡ç†
   - æ²¡æœ‰å¤šè½®å¯¹è¯è§„åˆ’

### âœ… å½“å‰å®ç°æ˜¯ RAG + LLM

**æ¶æ„ï¼š**
- **RAG (Retrieval-Augmented Generation)**: æ£€ç´¢å¢å¼ºç”Ÿæˆ
  - å‘é‡æ•°æ®åº“æ£€ç´¢
  - ç½‘é¡µå†…å®¹æŠ“å–
  - ä¸Šä¸‹æ–‡æ³¨å…¥

- **LLM (Large Language Model)**: å¤§è¯­è¨€æ¨¡å‹
  - Claude 3.5 Sonnet
  - æµå¼å“åº”
  - åŸºäºä¸Šä¸‹æ–‡çš„ç”Ÿæˆ

### ğŸ¤” ä¸ºä»€ä¹ˆä½¿ç”¨ "agent" å’Œ "client" æ¨¡å¼ï¼Ÿ

**è®¾è®¡ç›®çš„ï¼š**
1. **è§’è‰²åŒºåˆ†**ï¼šä¸åŒçš„ç”¨æˆ·ç¾¤ä½“éœ€è¦ä¸åŒçš„å›ç­”é£æ ¼
   - è´­æˆ¿è€…ï¼šéœ€è¦ç®€å•æ˜“æ‡‚çš„è§£é‡Š
   - æˆ¿äº§ä¸­ä»‹ï¼šéœ€è¦ä¸“ä¸šå‡†ç¡®çš„ä¿¡æ¯

2. **Prompt å·¥ç¨‹**ï¼šé€šè¿‡ä¸åŒçš„ system prompt å¼•å¯¼æ¨¡å‹è¡Œä¸º
   - æ”¹å˜å›ç­”çš„è¯­æ°”å’Œæ·±åº¦
   - è°ƒæ•´ä¸“ä¸šæœ¯è¯­çš„ä½¿ç”¨
   - ä¼˜åŒ–å›ç­”ç»“æ„

3. **æœªæ¥æ‰©å±•**ï¼šä¸ºçœŸæ­£çš„ Agent åŠŸèƒ½é¢„ç•™æ¥å£
   - å¯ä»¥é€æ­¥æ·»åŠ å·¥å…·è°ƒç”¨
   - å¯ä»¥æ·»åŠ å¤šæ­¥éª¤æ¨ç†
   - å¯ä»¥æ·»åŠ çŠ¶æ€ç®¡ç†

## å…³é”®å†³ç­–ç‚¹

### 1. ä½•æ—¶è°ƒç”¨å‘é‡æœç´¢ï¼Ÿ
**ç­”æ¡ˆï¼š** æ€»æ˜¯è°ƒç”¨
- æ¯ä¸ªæŸ¥è¯¢éƒ½ä¼šç”Ÿæˆ embedding
- åœ¨ Supabase å‘é‡æ•°æ®åº“ä¸­æœç´¢
- è¿”å›æœ€ç›¸å…³çš„ 4 æ¡ç»“æœ

### 2. ä½•æ—¶è°ƒç”¨ç½‘é¡µæŠ“å–ï¼Ÿ
**æ¡ä»¶ï¼š**
- âœ… `enableScraping === true`
- âœ… `JINA_API_KEY` å·²è®¾ç½®
- âœ… `isPolicyQuery(query) === true` (åŒ…å«æ”¿ç­–å…³é”®è¯)
- âœ… æŸ¥è¯¢ä¸­åŒ…å«æ”¿åºœç½‘ç«™ URL

**ç¤ºä¾‹å…³é”®è¯ï¼š**
- policy, policies
- procedure, procedures
- hdb, ura, government
- regulation, requirement
- law, legal

### 3. ä½•æ—¶ä½¿ç”¨ "agent" æ¨¡å¼ï¼Ÿ
**å½“å‰å®ç°ï¼š**
- é€šè¿‡ `ChatInterface` ç»„ä»¶çš„ `mode` prop ä¼ é€’
- é»˜è®¤æ˜¯ "client" æ¨¡å¼
- éœ€è¦åœ¨ç»„ä»¶ä¸­æ˜¾å¼è®¾ç½® `mode="agent"`

**æœªæ¥æ”¹è¿›å»ºè®®ï¼š**
- æ ¹æ®ç”¨æˆ·è§’è‰²è‡ªåŠ¨é€‰æ‹©
- æä¾› UI åˆ‡æ¢é€‰é¡¹
- åŸºäºæŸ¥è¯¢å†…å®¹æ™ºèƒ½é€‰æ‹©

## æ•°æ®æµ

```
ç”¨æˆ·è¾“å…¥
  â”‚
  â”œâ”€> å‰ç«¯: ChatInterface
  â”‚     â””â”€> useChat hook
  â”‚           â””â”€> POST /api/chat
  â”‚
  â”œâ”€> åç«¯: /api/chat
  â”‚     â”œâ”€> éªŒè¯ & è§£æ
  â”‚     â”œâ”€> RAG Pipeline
  â”‚     â”‚     â”œâ”€> å‘é‡æœç´¢ â†’ Supabase
  â”‚     â”‚     â””â”€> ç½‘é¡µæŠ“å– â†’ Jina (å¯é€‰)
  â”‚     â”œâ”€> æ„å»º Prompt
  â”‚     â””â”€> LLM è°ƒç”¨ â†’ Anthropic
  â”‚
  â””â”€> å“åº”
        â”œâ”€> æµå¼æ–‡æœ¬
        â””â”€> Sources (X-Sources header)
```

## ç¯å¢ƒå˜é‡ä¾èµ–

| å˜é‡ | ç”¨é€” | å¿…éœ€æ€§ |
|------|------|--------|
| `ANTHROPIC_API_KEY` | Claude API è°ƒç”¨ | âœ… å¿…éœ€ |
| `OPENAI_API_KEY` | Embedding ç”Ÿæˆ | âœ… å¿…éœ€ |
| `JINA_API_KEY` | ç½‘é¡µæŠ“å– | âš ï¸ å¯é€‰ |
| `NEXT_PUBLIC_SUPABASE_URL` | å‘é‡æ•°æ®åº“ | âœ… å¿…éœ€ |
| `NEXT_PUBLIC_SUPABASE_ANON_KEY` | Supabase è®¤è¯ | âœ… å¿…éœ€ |

## æ€§èƒ½è€ƒè™‘

1. **å‘é‡æœç´¢**ï¼š~200-500ms
   - Embedding ç”Ÿæˆï¼š~100-200ms
   - æ•°æ®åº“æŸ¥è¯¢ï¼š~100-300ms

2. **ç½‘é¡µæŠ“å–**ï¼š~1-3sï¼ˆå¦‚æœå¯ç”¨ï¼‰
   - Jina API è°ƒç”¨ï¼š~1-2s
   - å†…å®¹å¤„ç†ï¼š~100-500ms

3. **LLM è°ƒç”¨**ï¼š~2-5s
   - å–å†³äºå“åº”é•¿åº¦
   - æµå¼å“åº”ï¼Œé¦–å­—å»¶è¿Ÿ ~500ms-1s

**æ€»å“åº”æ—¶é—´ï¼š** ~3-8sï¼ˆåŒ…å«æŠ“å–ï¼‰æˆ– ~2-5sï¼ˆä¸åŒ…å«æŠ“å–ï¼‰

